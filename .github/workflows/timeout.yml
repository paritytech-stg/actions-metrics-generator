on:
  push:


jobs:
  job1:
    runs-on: ubuntu-latest
    timeout-minutes: 1

    steps:
      - name: sleep
        run: sleep 5m

  job2:
    runs-on: ubuntu-latest
    timeout-minutes: 1

    steps:
      - name: exit
        run: exit 0


  confirm-required-checks-passed:
    runs-on: ubuntu-latest
    name: All jons passed
    # If any new job gets added, be sure to add it to this array
    needs: [job1, job2]
    if: always() && !cancelled()
    steps:
      - run: |
          tee resultfile <<< '${{ toJSON(needs) }}'
          FAILURES=$(cat resultfile | grep -E '"result": "(failure|cancelled)"' | wc -l)
          if [ $FAILURES -gt 0 ]; then
            echo "### At least one required job failed âŒ" >> $GITHUB_STEP_SUMMARY
            exit 1
          else
            echo '### Good job! All the required jobs passed ðŸš€' >> $GITHUB_STEP_SUMMARY
          fi